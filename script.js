window.onload=(()=>{createDecodeElement(),createStatusElement(),createPanelElement()});let ready=[],isDecoded=!1;const decodeElement=document.createElement("button"),statusElement=document.createElement("button"),panelElement=document.createElement("div");function createDecodeElement(){decodeElement.id="decode",decodeElement.classList.add("mm"),decodeElement.classList.add("button"),decodeElement.classList.add("undecoded"),decodeElement.textContent="DECODE",decodeElement.addEventListener("click",decode),document.querySelector(".ytp-chrome-controls .ytp-right-controls").prepend(decodeElement)}function createStatusElement(){statusElement.id="status",statusElement.classList.add("mm"),statusElement.classList.add("button"),statusElement.classList.add("hidden"),statusElement.textContent="STATUS",statusElement.addEventListener("click",togglePanel),document.querySelector(".ytp-chrome-controls .ytp-left-controls").append(statusElement)}function createPanelElement(){panelElement.id="panel",panelElement.classList.add("mm"),panelElement.classList.add("panel"),panelElement.classList.add("hidden"),document.querySelector("#movie_player").append(panelElement)}function decode(){const e=document.querySelector("#canvas");decodeElement.classList.contains("undecoded")?setLoadingState(e):decodeElement.classList.contains("loading")?decodeElement.textContent="DECODING... Wait":decodeElement.classList.contains("decoded")&&setUndecodedState(e),isDecoded=!0}function setLoadingState(e){decodeElement.classList.remove("undecoded"),decodeElement.classList.add("loading"),statusElement.classList.remove("hidden"),e&&e.classList.remove("hidden"),decodeElement.textContent="DECODING...",isDecoded||decodeVideo()}function setDecodedState(){decodeElement.classList.remove("loading"),decodeElement.classList.add("decoded"),decodeElement.textContent="DECODED"}function setUndecodedState(e){decodeElement.classList.remove("decoded"),decodeElement.classList.add("undecoded"),statusElement.classList.add("hidden"),decodeElement.textContent="DECODE",panelElement.classList.add("hidden"),e&&e.classList.add("hidden")}function togglePanel(){panelElement.classList.toggle("hidden")}function decodeVideo(){const e=getConfig();if(!e)return;const t=e.URL_Player1,n=e.URL_Player2,o=e.URLS_player3,a=e.tempoDeInicioP3;let i,d,c,l;const s=function(){const e=document.getElementsByTagName("video")[0];return e.muted=!0,e.style.visibility="hidden",e.playbackRate=1,$("mainVideo"),e}();if(!s)return void console.log("VIDEO NÃO ENCONTRADO NESSA PÁGINA.");let u,r;s.addEventListener("play",A),s.addEventListener("pause",H),s.addEventListener("volumeChange",function(){console.log("OnVolumeChange"),h[V]&&s&&h[V].setVolume(100*s.volume);s&&(s.muted=!0);u&&(u.muted=!0);r&&(r.muted=!0)}),s.addEventListener("waiting",U),s.addEventListener("seeked",function(){console.log("OnSeeked"),H();const e=z();e!=V&&(!function(e){try{for(var t=0;t<a.length;t++)if((t!=V&&t!=V+1||e)&&null!=h[t]){var n=h[t].getIframe().id;try{document.body.removeChild(document.getElementById(n)),h[t]=null,p[V]=null}catch(e){}}}catch(e){}}(deleteAllSounds=!0),console.log("newIndex != soundIndex: soundIndex == "+V+" newIndex == "+e),V=e,F());W(),u&&r&&P()});let m,y,g,p=[],h=[],E=s.clientHeight,f=s.clientWidth,v=s.videoHeight,T=s.videoWidth,b=s.videoHeight,L=s.videoWidth,C=s.videoHeight,k=s.videoWidth;const R=document.createElement("script");R.src="https://www.youtube.com/iframe_api";const w=document.getElementsByTagName("script")[0];w.parentNode.insertBefore(R,w);let V=z();const M=function(e,t=0){const n=document.createElement("canvas");return n.id=e,n.width=f,n.height=E,s.parentElement.appendChild(n),n.style.zIndex=t,n.style.position="relative",n}("canvas",10),I=M.getContext("2d"),S=.05;function B(e,t,n=E,o=f,a){return function(e){const t=document.createElement("div");t.id=e,t.style.zIndex=-10,t.style.position="absolute",t.style.marginTop="0px",t.style.left="-5000px",document.body.appendChild(t)}(e),new YT.Player(e,{height:n,width:o,videoId:e,playerVars:{controls:1,related:0,keyboard:0,showinfo:0,autoplay:1},events:{onReady:t,onPlaybackQualityChange:a}})}function D(e){return new Promise(t=>{const n=document.getElementById(e);n.onload=function(){if(video=(n.contentDocument||n.contentWindow.document).getElementsByTagName("video")[0],!video)throw new Error("Video "+e+"não encontrado.");t(video)}})}function N(){console.log("PlayerA Ready"),m.playVideo()}function x(){console.log("PlayerB Ready"),y.playVideo()}function P(){I.drawImage(r,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),I.drawImage(u,d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7]),I.drawImage(r,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]),I.drawImage(u,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7])}function W(){M.width=f=s.clientWidth,M.height=E=s.clientHeight,v=s.videoHeight,T=s.videoWidth,u&&(b=u.videoHeight,L=u.videoWidth),r&&(C=r.videoHeight,k=r.videoWidth),i=[0,0,Math.ceil(k/2),Math.ceil(C/2),Math.floor(f/2),Math.floor(E/2),Math.ceil(f/2),Math.ceil(E/2)],d=[Math.ceil(L/2),0,Math.floor(L/2),Math.ceil(b/2),0,Math.floor(E/2),Math.floor(f/2),Math.ceil(E/2)],c=[0,Math.ceil(C/2),Math.ceil(k/2),Math.floor(C/2),Math.floor(f/2),0,Math.ceil(f/2),Math.floor(E/2)],l=[Math.ceil(L/2),Math.ceil(b/2),Math.floor(L/2),Math.floor(b/2),0,0,Math.floor(f/2),Math.floor(E/2)]}function O(){if(!(s.paused|s.ended)){P(),Math.abs(s.currentTime-m.getCurrentTime())>S?s.currentTime-m.getCurrentTime()>0?u.playbackRate=s.playbackRate+Math.min(15,s.currentTime-m.getCurrentTime()):u.playbackRate=s.playbackRate+Math.max(-.93,s.currentTime-m.getCurrentTime()):u.playbackRate=s.playbackRate,Math.abs(s.currentTime-y.getCurrentTime())>S?s.currentTime-y.getCurrentTime()>0?r.playbackRate=s.playbackRate+Math.min(15,s.currentTime-y.getCurrentTime()):r.playbackRate=s.playbackRate+Math.max(-.93,s.currentTime-y.getCurrentTime()):r.playbackRate=s.playbackRate;try{Math.abs(s.currentTime-a[V]-h[V].getCurrentTime())>S?s.currentTime-a[V]-h[V].getCurrentTime()>0?p[V].playbackRate=s.playbackRate+Math.min(15,s.currentTime-a[V]-h[V].getCurrentTime()):p[V].playbackRate=s.playbackRate+Math.max(-.93,s.currentTime-a[V]-h[V].getCurrentTime()):p[V].playbackRate=s.playbackRate}catch(e){}}}function A(){m&&y&&h[V]&&m.getPlayerState()!=YT.PlayerState.BUFFERING&&y.getPlayerState()!=YT.PlayerState.BUFFERING&&h[V].getPlayerState()!=YT.PlayerState.BUFFERING?(m.playVideo(),y.playVideo(),h[V].playVideo(),h[V].setVolume(100*s.volume),g=setInterval(O,1e3/60)):H()}function H(){console.log("Pause"),s&&(s.pause(),s.muted=!0),u&&(m.pauseVideo(),m.seekTo(s.currentTime,!0),u&&(u.muted=!0)),r&&(y.pauseVideo(),y.seekTo(s.currentTime,!0),r&&(r.muted=!0)),p[V]&&(h[V].pauseVideo(),h[V].seekTo(s.currentTime-a[V],!0),h[V].setVolume(100*s.volume)),clearInterval(g),setTimeout(W,1e3),setTimeout(function(){u&&r&&P()},1e3)}function U(){console.log("OnWaiting"),H()}function q(){this.index!=V||this.dontPauseOnonwaiting||H()}function z(){for(let e=0;e<a.length-1;e++)if(s.currentTime>=a[e]&&s.currentTime<a[e+1])return e;return a.length-1}function G(){if(h[V]){const e=h[V].getIframe().id;document.body.removeChild(document.getElementById(e)),h[V]=null,p[V]=null}}function F(){h[V]=B(o[V],function(){h[V].playVideo(),h[V].setVolume(0)},144,360),h[V+1]=B(o[V+1],function(){h[V+1].playVideo(),h[V+1].setVolume(0)},144,360),D(o[V]).then(e=>{p[V]=e,p[V].index=V,p[V].style.visibility="hidden",p[V].onwaiting=q,p[V].addEventListener("ended",function(){console.log("audio",V,"terminado"),(s.currentTime<a[V+2]||V+1==a.length-1)&&(G(),V=z(),_())}),p[V].addEventListener("canplaythrough",function(){console.log("Audio",V," canplaythrough"),$("video3")})}),D(o[V+1]).then(e=>{p[V+1]=e,p[V+1].index=V+1,p[V+1].style.visibility="hidden",p[V+1].onwaiting=q,p[V+1].addEventListener("ended",function(){console.log("audio",V+1,"terminado"),(s.currentTime<a[V+2]||V+1==a.length-1)&&(G(),V=z(),_())}),p[V+1].playbackRate=.07,p[V+1].addEventListener("canplaythrough",function(){setTimeout(()=>{p[V+1].playbackRate=1,p[V+1].pause(),console.log("video3[",V+1,"] foi pausado. Esperando sua vez para despausar."),console.log("Tempo de video:",p[V+1].currentTime)},2e3),console.log("Audio",V+1," canplaythrough"),$("video3")})}),console.log("GetTwoSounds")}function _(){p[V].playbackRate=s.playbackRate,h[V].setVolume(100*s.volume),p[V].dontPauseOnonwaiting=!0,h[V].seekTo(s.currentTime-a[V],!0),h[V+1]=B(o[V+1],function(){h[V+1].playVideo(),h[V+1].setVolume(0)},144,360),D(o[V+1]).then(e=>{p[V+1]=e,p[V+1].index=V+1,p[V+1].style.visibility="hidden",p[V+1].onwaiting=q,p[V+1].addEventListener("ended",function(){console.log("audio",V+1,"terminado"),(s.currentTime<a[V+2]||V+1==a.length-1)&&(G(),V=z(),_())}),p[V+1].addEventListener("canplaythrough",function(){setTimeout(()=>{p[V+1].playbackRate=1,p[V+1].pause(),console.log("video3[",V+1,"] foi pausado. Esperando sua vez para despausar."),console.log("Tempo de video:",p[V+1].currentTime)},2e3),console.log("Audio",V+1," canplaythrough"),$("video3")})}),A()}function Y(e){const o=document.getElementById(t),a=document.getElementById(n);(o.contentDocument||o.contentWindow.document).getElementsByClassName("ytp-button ytp-settings-button")[0].click(),(o.contentDocument||o.contentWindow.document).getElementsByClassName("ytp-menuitem")[(o.contentDocument||o.contentWindow.document).getElementsByClassName("ytp-menuitem").length-1].click(),setTimeout(function(){(o.contentDocument||o.contentWindow.document).getElementsByClassName("ytp-menuitem-label")[e].click()},400),setTimeout(function(){(a.contentDocument||a.contentWindow.document).getElementsByClassName("ytp-button ytp-settings-button")[0].click(),(a.contentDocument||a.contentWindow.document).getElementsByClassName("ytp-menuitem")[(a.contentDocument||a.contentWindow.document).getElementsByClassName("ytp-menuitem").length-1].click(),setTimeout(function(){(a.contentDocument||a.contentWindow.document).getElementsByClassName("ytp-menuitem-label")[e].click()},400)},500)}function $(e){if(console.log("setReadyElements:",e),ready.includes(e)||ready.push(e),!decodeElement.classList.contains("decoded")){["mainVideo","videoA","videoB","video3"].every(e=>ready.includes(e))&&(console.log(ready),setDecodedState(),H())}}document.querySelector("#movie_player").addEventListener("resize",function(){W()}),document.querySelector("video").addEventListener("resize",function(){W()}),window.onYouTubeIframeAPIReady=function(){s.pause(),m=B(t,N,144,360,W),y=B(n,x,144,360,W),D(t).then(e=>{(u=e).onwaiting=U,b=u.videoHeight,L=u.videoWidth,u.onseeked=function(){u&&r&&P()},u.muted=!0,u.style.visibility="hidden",u.addEventListener("resize",function(){W()}),u.addEventListener("pause",function(){u&&r&&P()}),u.addEventListener("canplaythrough",function(){console.log("VideoA canplaythrough"),$("videoA")})}).catch(console.error),D(n).then(e=>{(r=e).onwaiting=U,C=r.videoHeight,k=r.videoWidth,r.onseeked=function(){u&&r&&P()},r.muted=!0,r.style.visibility="hidden",r.addEventListener("resize",function(){W()}),r.addEventListener("pause",function(){u&&r&&P()}),r.addEventListener("canplaythrough",function(){console.log("VideoB canplaythrough"),$("videoB")})}).catch(console.error),F()},document.getElementsByClassName("ytp-button ytp-settings-button")[0].onclick=function(){setTimeout(function(){document.getElementsByClassName("ytp-menuitem")[document.getElementsByClassName("ytp-menuitem").length-1].onclick=function(){setTimeout(function(){for(var e=0;e<document.getElementsByClassName("ytp-menuitem-label").length;e++)document.getElementsByClassName("ytp-menuitem-label")[e].index=e,document.getElementsByClassName("ytp-menuitem-label")[e].onclick=function(){setTimeout(Y(this.index),300)}},400)}},400)},setInterval(function(){setPanelContent({"Url do Vídeo parte 1":t,"Url do Vídeo parte 2":n,"Urls dos Vídeos de Audio":o,"Tempos de início de cada Audio":a,"Vídeo Principal (Vídeo atual)":s,"Vídeo Parte 1 (esquerdo)":u,"Vídeo Parte 2 (direito)":r,"Vídeo do audio atual":p[V]})})}function setPanelContent(e){const t=document.querySelector("#panel");let n,o;t.innerHTML="",Object.entries(e).forEach(e=>{n=e[0],o=e[1],t.innerHTML+=`\n        <panelElement>${e[0]}: <span style="color: ${exists(e[1])?"lawngreen":"red"};">${exists(e[1])?"OK!":"ERROR!"}</span></panelElement>\n        `})}function exists(e){return!!e&&((!Array.isArray(e)||0!==e.length)&&!("string"==typeof e&&!e.trim()))}function getConfig(){const e=document.querySelector("#description").textContent;if(!e)return"";const t=e.split("[[[")[1].split("]]]")[0];try{return JSON.parse(t)}catch(e){return console.log("ERROR: Informações de configuração não encontradas na descrição."),""}}